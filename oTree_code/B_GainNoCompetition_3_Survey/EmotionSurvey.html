{% extends "global/Page.html" %}
{% load otree %}

{% block content %}
<style>
    .content-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 30px 20px;
    }

    .quiz-title {
        font-size: 24px;
        color: #000;
        margin-bottom: 40px;
        font-weight: bold;
        line-height: 1.5;
    }

    /* Table styling */
    .emotion-table {
        width: 100%;
        border-collapse: collapse;
        margin: 30px 0;
    }

    .emotion-table th, .emotion-table td {
        padding: 12px 8px;
        text-align: center;
        vertical-align: middle;
    }

    .emotion-table th {
        font-size: 20px;
        font-weight: bold;
    }

    .emotion-table td:first-child {
        text-align: left;
        font-size: 20px;
        font-weight: bold;
        padding-left: 20px;
        width: 250px;
    }

    /* Optimized radio button styling */
    .radio-input {
        height: 18px;
        width: 18px;
        cursor: pointer;
        /* Remove default styling and shadow */
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border: 2px solid #666;
        border-radius: 50%;
        background-color: white;
        outline: none;
        box-shadow: none;
    }

    /* Selected state */
    .radio-input:checked {
        background-color: #4d7ef7;
        border-color: #4d7ef7;
        position: relative;
    }

    /* Inner dot when selected */
    .radio-input:checked::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: white;
    }

    /* Aligns the button at the bottom right */
    .button-container {
        display: flex;
        justify-content: flex-end;
        margin-top: 30px;
    }

    /* Make oTree's next button larger while keeping its original color */
    .otree-btn-next {
        font-size: 20px;
        padding: 9px 25px;
    }

    /* Progress Bar Styles */
    .progress-container {
        width: 100%;
        height: 12px;
        background-color: #e9ecef;
        border-radius: 6px;
        margin-bottom: 25px;
        overflow: hidden;
    }

    .progress-bar {
        height: 100%;
        background-color: #4d7ef7;
        transition: width 0.3s ease;
    }

    /* Validation message */
    .validation-message {
        color: #e74c3c;
        font-size: 16px;
        margin-top: 15px;
        text-align: center;
        display: none;
    }
</style>

<div class="content-container">
    <!-- Global progress bar template -->
    {% include 'global/ProgressBar.html' %}

    <h1 class="quiz-title">Thinking back to how you felt during the IQ Quiz,
        please indicate to what extent you were experiencing
        the following, on a scale from
        1 (not at all) to 7 (extremely):</h1>

    <form method="post" id="emotionForm" onsubmit="return validateForm()">
        <table class="emotion-table">
            <thead>
                <tr>
                    <th></th>
                    <th>1</th>
                    <th>2</th>
                    <th>3</th>
                    <th>4</th>
                    <th>5</th>
                    <th>6</th>
                    <th>7</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Stress</td>
                    <td><input type="radio" name="emotion_stress" value="1" class="radio-input" required></td>
                    <td><input type="radio" name="emotion_stress" value="2" class="radio-input"></td>
                    <td><input type="radio" name="emotion_stress" value="3" class="radio-input"></td>
                    <td><input type="radio" name="emotion_stress" value="4" class="radio-input"></td>
                    <td><input type="radio" name="emotion_stress" value="5" class="radio-input"></td>
                    <td><input type="radio" name="emotion_stress" value="6" class="radio-input"></td>
                    <td><input type="radio" name="emotion_stress" value="7" class="radio-input"></td>
                </tr>
                <!-- REMOVED: Tension row -->
                <tr>
                    <td>Excitement</td>
                    <td><input type="radio" name="emotion_excitement" value="1" class="radio-input" required></td>
                    <td><input type="radio" name="emotion_excitement" value="2" class="radio-input"></td>
                    <td><input type="radio" name="emotion_excitement" value="3" class="radio-input"></td>
                    <td><input type="radio" name="emotion_excitement" value="4" class="radio-input"></td>
                    <td><input type="radio" name="emotion_excitement" value="5" class="radio-input"></td>
                    <td><input type="radio" name="emotion_excitement" value="6" class="radio-input"></td>
                    <td><input type="radio" name="emotion_excitement" value="7" class="radio-input"></td>
                </tr>
                <tr>
                    <td>Satisfaction</td>
                    <td><input type="radio" name="emotion_satisfaction" value="1" class="radio-input" required></td>
                    <td><input type="radio" name="emotion_satisfaction" value="2" class="radio-input"></td>
                    <td><input type="radio" name="emotion_satisfaction" value="3" class="radio-input"></td>
                    <td><input type="radio" name="emotion_satisfaction" value="4" class="radio-input"></td>
                    <td><input type="radio" name="emotion_satisfaction" value="5" class="radio-input"></td>
                    <td><input type="radio" name="emotion_satisfaction" value="6" class="radio-input"></td>
                    <td><input type="radio" name="emotion_satisfaction" value="7" class="radio-input"></td>
                </tr>
                <tr>
                    <td>Embarrassment</td>
                    <td><input type="radio" name="emotion_embarrassment" value="1" class="radio-input" required></td>
                    <td><input type="radio" name="emotion_embarrassment" value="2" class="radio-input"></td>
                    <td><input type="radio" name="emotion_embarrassment" value="3" class="radio-input"></td>
                    <td><input type="radio" name="emotion_embarrassment" value="4" class="radio-input"></td>
                    <td><input type="radio" name="emotion_embarrassment" value="5" class="radio-input"></td>
                    <td><input type="radio" name="emotion_embarrassment" value="6" class="radio-input"></td>
                    <td><input type="radio" name="emotion_embarrassment" value="7" class="radio-input"></td>
                </tr>
                <tr>
                    <td>Anxiety</td>
                    <td><input type="radio" name="emotion_anxiety" value="1" class="radio-input" required></td>
                    <td><input type="radio" name="emotion_anxiety" value="2" class="radio-input"></td>
                    <td><input type="radio" name="emotion_anxiety" value="3" class="radio-input"></td>
                    <td><input type="radio" name="emotion_anxiety" value="4" class="radio-input"></td>
                    <td><input type="radio" name="emotion_anxiety" value="5" class="radio-input"></td>
                    <td><input type="radio" name="emotion_anxiety" value="6" class="radio-input"></td>
                    <td><input type="radio" name="emotion_anxiety" value="7" class="radio-input"></td>
                </tr>
            </tbody>
        </table>

        <div class="validation-message" id="validationMessage">Please answer all questions to continue.</div>

        <br>

        <div class="button-container">
            {% next_button %}
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Make the entire row highlight when moused over
        const tableRows = document.querySelectorAll('.emotion-table tbody tr');
        tableRows.forEach(row => {
            row.addEventListener('mouseover', function() {
                this.style.backgroundColor = '#f8f9fa';
            });
            row.addEventListener('mouseout', function() {
                this.style.backgroundColor = '';
            });
        });
    });

    function validateForm() {
        const form = document.getElementById('emotionForm');
        const emotionFields = [
            'emotion_stress',
            // REMOVED: 'emotion_tension',
            'emotion_excitement',
            'emotion_satisfaction',
            'emotion_embarrassment',
            'emotion_anxiety'
        ];

        let isValid = true;

        for (const fieldName of emotionFields) {
            const radios = form.elements[fieldName];
            let fieldChecked = false;

            for (let i = 0; i < radios.length; i++) {
                if (radios[i].checked) {
                    fieldChecked = true;
                    break;
                }
            }

            if (!fieldChecked) {
                isValid = false;
                break;
            }
        }

        if (!isValid) {
            document.getElementById('validationMessage').style.display = 'block';
            return false;
        }

        return true;
    }
</script>
{% endblock %}