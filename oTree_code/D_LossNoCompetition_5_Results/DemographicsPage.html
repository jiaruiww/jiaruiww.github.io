{% extends "global/Page.html" %}
{% load otree %}

{% block content %}
<style>
    /* Progress Bar Styles */
    .progress-container {
        width: 100%;
        height: 12px;
        background-color: #e9ecef;
        border-radius: 6px;
        margin-bottom: 25px;
        overflow: hidden;
    }

    .progress-bar {
        height: 100%;
        background-color: #4d7ef7; /* Blue color */
        transition: width 0.3s ease;
    }

    .content-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 30px 20px;
    }

    .intro-text {
        font-size: 18px;
        color: #555;
        margin-bottom: 40px;
        text-align: center;
    }

    .question-section {
        margin-bottom: 40px;
        border-bottom: 1px solid #eee;
        padding-bottom: 30px;
    }

    .question-section:last-of-type {
        border-bottom: none;
    }

    .question-title {
        font-size: 20px;
        color: #000;
        margin-bottom: 20px;
        font-weight: bold;
    }

    .option-container {
        margin-bottom: 10px;
    }

    .option-box {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 12px 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        width: 100%;
        max-width: 900px;
        box-sizing: border-box;
        min-width: 350px;
    }

    .option-box:hover {
        background-color: #f8f9fa;
    }

    .radio-circle {
        width: 20px;
        height: 20px;
        border: 1px solid #ccc;
        border-radius: 50%;
        margin-right: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .option-text {
        font-size: 16px;
        flex-grow: 1;
    }

    input[type="radio"] {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
    }

    input[type="radio"]:checked + .option-box .radio-circle {
        border-color: #4d7ef7;
    }

    input[type="radio"]:checked + .option-box .radio-circle::after {
        content: "";
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: #4d7ef7;
    }

    /* Year select dropdown styling */
    .year-select {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 12px 20px;
        font-size: 16px;
        width: 250px;
        box-sizing: border-box;
        background-color: white;
        cursor: pointer;
    }

    .year-select:focus {
        outline: none;
        border-color: #4d7ef7;
    }

    .year-select:hover {
        border-color: #999;
    }

    /* When no option is selected */
    .year-select option[value=""] {
        color: #999;
    }

    /* Aligns the button at the bottom right */
    .button-container {
        display: flex;
        justify-content: flex-end;
        margin-top: 40px;
    }

    /* Make oTree's next button larger while keeping its original color */
    .otree-btn-next {
        font-size: 20px;
        padding: 9px 25px;
    }

    .bottom-instruction {
    color: #888;
    font-size: 14px;
    text-align: center;
    margin-top: -20px;
    padding-top: 1px;

}

    .validation-message {
        color: #e74c3c;
        font-size: 14px;
        margin-top: 10px;
        display: none;
    }
</style>

<div class="content-container">
    <div class="progress-container">
        {% include 'global/ProgressBar.html' %}
    </div>

    <div class="intro-text">
        We have only a few short questions left.
    </div>

    <form method="post" id="demographicsForm" onsubmit="return validateForm()">

        <!-- Birth Year Question -->
        <div class="question-section">
            <h3 class="question-title">Which year were you born?</h3>
            <select name="birth_year" class="year-select" required>
                <option value="">Select your birth year</option>
                <option value="2010">2010</option>
                <option value="2009">2009</option>
                <option value="2008">2008</option>
                <option value="2007">2007</option>
                <option value="2006">2006</option>
                <option value="2005">2005</option>
                <option value="2004">2004</option>
                <option value="2003">2003</option>
                <option value="2002">2002</option>
                <option value="2001">2001</option>
                <option value="2000">2000</option>
                <option value="1999">1999</option>
                <option value="1998">1998</option>
                <option value="1997">1997</option>
                <option value="1996">1996</option>
                <option value="1995">1995</option>
                <option value="1994">1994</option>
                <option value="1993">1993</option>
                <option value="1992">1992</option>
                <option value="1991">1991</option>
                <option value="1990">1990</option>
                <option value="1989">1989</option>
                <option value="1988">1988</option>
                <option value="1987">1987</option>
                <option value="1986">1986</option>
                <option value="1985">1985</option>
                <option value="1984">1984</option>
                <option value="1983">1983</option>
                <option value="1982">1982</option>
                <option value="1981">1981</option>
                <option value="1980">1980</option>
                <option value="1979">1979</option>
                <option value="1978">1978</option>
                <option value="1977">1977</option>
                <option value="1976">1976</option>
                <option value="1975">1975</option>
                <option value="1974">1974</option>
                <option value="1973">1973</option>
                <option value="1972">1972</option>
                <option value="1971">1971</option>
                <option value="1970">1970</option>
                <option value="1969">1969</option>
                <option value="1968">1968</option>
                <option value="1967">1967</option>
                <option value="1966">1966</option>
                <option value="1965">1965</option>
                <option value="1964">1964</option>
                <option value="1963">1963</option>
                <option value="1962">1962</option>
                <option value="1961">1961</option>
                <option value="1960">1960</option>
                <option value="1959">1959</option>
                <option value="1958">1958</option>
                <option value="1957">1957</option>
                <option value="1956">1956</option>
                <option value="1955">1955</option>
                <option value="1954">1954</option>
                <option value="1953">1953</option>
                <option value="1952">1952</option>
                <option value="1951">1951</option>
                <option value="1950">1950</option>
                <option value="1949">1949</option>
                <option value="1948">1948</option>
                <option value="1947">1947</option>
                <option value="1946">1946</option>
                <option value="1945">1945</option>
                <option value="1944">1944</option>
                <option value="1943">1943</option>
                <option value="1942">1942</option>
                <option value="1941">1941</option>
                <option value="1940">1940</option>
                <option value="1939">1939</option>
                <option value="1938">1938</option>
                <option value="1937">1937</option>
                <option value="1936">1936</option>
                <option value="1935">1935</option>
                <option value="1934">1934</option>
                <option value="1933">1933</option>
                <option value="1932">1932</option>
                <option value="1931">1931</option>
                <option value="1930">1930</option>
                <option value="1929">1929</option>
                <option value="1928">1928</option>
                <option value="1927">1927</option>
                <option value="1926">1926</option>
                <option value="1925">1925</option>
                <option value="1924">1924</option>
                <option value="1923">1923</option>
                <option value="1922">1922</option>
                <option value="1921">1921</option>
                <option value="1920">1920</option>
            </select>
            <div class="validation-message" id="birthYearValidation">Please select your birth year.</div>
        </div>

        <!-- Gender Question -->
        <div class="question-section">
            <h3 class="question-title">What's your gender?</h3>

            <div class="option-container">
                <label>
                    <input type="radio" name="gender" value="male" required>
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Male</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="gender" value="female">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Female</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="gender" value="other">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Other</span>
                    </div>
                </label>
            </div>
            <div class="validation-message" id="genderValidation">Please select your gender.</div>
        </div>

        <!-- Race/Ethnicity Question -->
        <div class="question-section">
            <h3 class="question-title">How would you describe your race or ethnicity?</h3>

            <div class="option-container">
                <label>
                    <input type="radio" name="race_ethnicity" value="white" required>
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">White</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="race_ethnicity" value="african_american">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">African-American</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="race_ethnicity" value="hispanic">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Hispanic</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="race_ethnicity" value="american_indian">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">American Indian or Alaska Native</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="race_ethnicity" value="asian">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Asian</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="race_ethnicity" value="other">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Other</span>
                    </div>
                </label>
            </div>
            <div class="validation-message" id="raceValidation">Please select your race or ethnicity.</div>
        </div>

        <!-- Education Question -->
        <div class="question-section">
            <h3 class="question-title">How would you describe your educational attainment?</h3>

            <div class="option-container">
                <label>
                    <input type="radio" name="education" value="no_high_school" required>
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">No high school graduation</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="education" value="high_school">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">High school graduate</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="education" value="bachelors">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Bachelor's degree</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="education" value="graduate">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Graduate or professional degree</span>
                    </div>
                </label>
            </div>
            <div class="validation-message" id="educationValidation">Please select your educational attainment.</div>
        </div>

        <!-- Income Question -->
        <div class="question-section">
            <h3 class="question-title">What's your approximate annual household income before taxes?</h3>

            <div class="option-container">
                <label>
                    <input type="radio" name="income" value="below_10000" required>
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Below $10,000</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="income" value="10000_14999">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">$10,000—$14,999</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="income" value="15000_24999">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">$15,000—$24,999</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="income" value="25000_34999">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">$25,000—$34,999</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="income" value="35000_49999">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">$35,000—$49,999</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="income" value="50000_74999">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">$50,000—$74,999</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="income" value="75000_99999">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">$75,000—$99,999</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="income" value="100000_149999">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">$100,000—$149,999</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="income" value="150000_199999">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">$150,000—$199,999</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="income" value="200000_more">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">$200,000 or more</span>
                    </div>
                </label>
            </div>
            <div class="validation-message" id="incomeValidation">Please select your income range.</div>
        </div>

        <!-- Employment Question -->
        <div class="question-section">
            <h3 class="question-title">Are you employed full-time?</h3>

            <div class="option-container">
                <label>
                    <input type="radio" name="employment" value="yes" required>
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Yes</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="employment" value="no">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">No</span>
                    </div>
                </label>
            </div>
            <div class="validation-message" id="employmentValidation">Please select your employment status.</div>
        </div>

        <!-- Economic Policy Question -->
        <div class="question-section">
            <h3 class="question-title">On economic policy matters, where do you see yourself on the left-right spectrum?</h3>

            <div class="option-container">
                <label>
                    <input type="radio" name="economic_spectrum" value="extreme_left" required>
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Extreme Left</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="economic_spectrum" value="leaning_left">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Leaning Left</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="economic_spectrum" value="center">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Center</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="economic_spectrum" value="leaning_right">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Leaning Right</span>
                    </div>
                </label>
            </div>

            <div class="option-container">
                <label>
                    <input type="radio" name="economic_spectrum" value="extreme_right">
                    <div class="option-box">
                        <div class="radio-circle"></div>
                        <span class="option-text">Extreme Right</span>
                    </div>
                </label>
            </div>
            <div class="validation-message" id="economicValidation">Please select your position on the economic spectrum.</div>
        </div>

        <div class="validation-message" id="generalValidation" style="text-align: center; font-size: 16px; margin-top: 20px;">
            Please answer all questions to continue.
        </div>

        <div class="bottom-instruction">
         <i>Please answer all questions to continue.</i>
        </div>

        <br>

        <div class="button-container">
            {% next_button %}
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const optionBoxes = document.querySelectorAll('.option-box');
        optionBoxes.forEach(box => {
            box.addEventListener('click', function() {
                const radioInput = this.parentElement.querySelector('input[type="radio"]');
                radioInput.checked = true;
                const event = new Event('change');
                radioInput.dispatchEvent(event);

                // Hide validation message for this question when an option is selected
                const questionSection = this.closest('.question-section');
                const validationMessage = questionSection.querySelector('.validation-message');
                if (validationMessage) {
                    validationMessage.style.display = 'none';
                }
            });
        });

        const radioCircles = document.querySelectorAll('.radio-circle');
        radioCircles.forEach(circle => {
            circle.addEventListener('click', function() {
                const radioInput = this.closest('label').querySelector('input[type="radio"]');
                if (radioInput) {
                    radioInput.checked = true;
                    const event = new Event('change');
                    radioInput.dispatchEvent(event);

                    // Hide validation message for this question when an option is selected
                    const questionSection = this.closest('.question-section');
                    const validationMessage = questionSection.querySelector('.validation-message');
                    if (validationMessage) {
                        validationMessage.style.display = 'none';
                    }
                }
            });
        });

        // Hide birth year validation when user selects an option
        const birthYearSelect = document.querySelector('select[name="birth_year"]');
        if (birthYearSelect) {
            birthYearSelect.addEventListener('change', function() {
                document.getElementById('birthYearValidation').style.display = 'none';
            });
        }
    });

    function validateForm() {
        let isValid = true;

        // Validate birth year (now a select dropdown)
        const birthYear = document.querySelector('select[name="birth_year"]').value;
        if (!birthYear) {
            document.getElementById('birthYearValidation').style.display = 'block';
            isValid = false;
        }

        // Validate radio button groups
        const radioGroups = ['gender', 'race_ethnicity', 'education', 'income', 'employment', 'economic_spectrum'];

        radioGroups.forEach(groupName => {
            const radios = document.querySelectorAll(`input[name="${groupName}"]`);
            const isChecked = Array.from(radios).some(radio => radio.checked);

            if (!isChecked) {
                const validationId = groupName === 'race_ethnicity' ? 'raceValidation' :
                                   groupName === 'economic_spectrum' ? 'economicValidation' :
                                   groupName + 'Validation';
                const validationElement = document.getElementById(validationId);
                if (validationElement) {
                    validationElement.style.display = 'block';
                }
                isValid = false;
            }
        });

        if (!isValid) {
            document.getElementById('generalValidation').style.display = 'block';
            // Scroll to top to show errors
            window.scrollTo(0, 0);
        } else {
            document.getElementById('generalValidation').style.display = 'none';
        }

        return isValid;
    }
</script>
{% endblock %}